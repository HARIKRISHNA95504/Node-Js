# Git 
* Navigate to project folder
```
cd C:\Users\HARIKRISHNA\Desktop\NodeJs
```
* initialize the git
```
git init
```
* Add remote origin
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs> git remote add origin https://github.com/HARIKRISHNA95504/Node-Js.git
```
* stage Files
```
git add .
```
* Commit changes
```
git commit -m "crates express project"
```
* Push to the remote repository
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs> git branch -M main
PS C:\Users\HARIKRISHNA\Desktop\NodeJs> git push -u origin main
```
* having error on the pushing time
```
To https://github.com/HARIKRISHNA95504/Node-Js.git
 ! [rejected]        main -> main (fetch first)
error: failed to push some refs to 'https://github.com/HARIKRISHNA95504/Node-Js.git'
hint: Updates were rejected because the remote contains work that you do not
hint: have locally. This is usually caused by another repository pushing to
hint: the same ref. If you want to integrate the remote changes, use
hint: 'git pull' before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
```
```
git pull origin main --allow-unrelated-histories
git push origin main
```
* for the forced to push
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs> git push origin main --force
```
# 29-10-2024 Topic : MangoDb 
* first go to the mangodb website
```
https://cloud.mongodb.com/v2/6840d8e387b5b152d3f649e4#/overview
```
* click on create
```
to create a cluster
Note : only one cluster is free
```
* to connect this click on connetct
* Then go to the compass
* connecting with the mangodb compass give the details
```
* i have mangodb compass install
```
* take the url is mandatory for conneting the database
* Mangodb Compass installation
```
https://www.mongodb.com/try/download/shell
```
* to douwnload this
```
MongoDB Compass Download (GUI)
```
* go to the database Access
```
* inside this password is autogenerated
* give the username in the password section
* give the as "Atlas Admin"
* then click Add user
```
* Go the mangodb connection give the Url and Click on Conetion
```
UserName: Harikrishna
Password: @20FH1a0596
```
```
mongodb+srv://Harikrishna:<db_password>@nodejs-cluster1.rm9towc.mongodb.net/
```
* go to the mangodb compasss
* click on the add New connection and past the url
```
mongodb+srv://Harikrishna:@20FH1a0596@nodejs-cluster1.rm9towc.mongodb.net/
```
* After that Open the mangodb compass
*  in mangodb click on conected cluster
*  then right corner have a mangodb shell
*  in that click on create database to for database creation
*  and give the database name and collection Name
*  then click on create
# 30-10-2024 Topic : Mangodb Setup & Querie
# Commands
* showdbs
* Atlas atlas-purygc-shard-0 [primary] ecommerce> show dbs
```
ecommerce-dev    8.00 KiB
admin          360.00 KiB
local           30.64 GiB
```
* switched to database
* use databaseName 
```
 Atlas atlas-purygc-shard-0 [primary] ecommerce> use ecommerce-dev
```
* to see the what are the collections we have
* command : show collections
*  Atlas atlas-purygc-shard-0 [primary] ecommerce> show collections
```
show collections
users
```
* To see the records insides the collection
* command : db.users.countDocuments()
* Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.countDocuments()
```
db.users.countDocuments()
0
```
* To insert the record in to this
* command : db.users.insertOne({firstName:'Charan',lastName:'K',email:'charan.k@gmail.com',mobile:'9090909090'})
*  Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.insertOne({firstName:'Charan',lastName:'K',email:'charan.k@gmail.com',mobile:'9090909090'})
```
{
  acknowledged: true,
  insertedId: ObjectId('68411eb61c399b5b0f065846')
}
```
* Retriving the all records in the collection
* command : db.users.find()
* Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.find()
```
{
  _id: ObjectId('68411eb61c399b5b0f065846'),
  firsrName: 'Charan',
  lastName: 'K',
  email: 'charan.k@gmail.com',
  mobile: 9090909090
}
```
* To retrive a specific record
* command : db.findOne()
*  Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.findOne({email:'charan.k@gmail.com'})
```
{
  _id: ObjectId('68411eb61c399b5b0f065846'),
  firsrName: 'Charan',
  lastName: 'K',
  email: 'charan.k@gmail.com',
  mobile: 9090909090
}
```
* To remove or delete a particular method
*  command : db.users.deleteOne({_id: ObjectId('684120461c399b5b0f065847')})
* Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.deleteOne({  _id: ObjectId('684120461c399b5b0f065847')})
```
{
  acknowledged: true,
  deletedCount: 1
}
```
* To update the record
* command : db.users.update
* Atlas atlas-purygc-shard-0 [primary] ecommerce> db.users.updateOne({id: ObjectId('68411eb61c399b5b0f065846')},{$set:{mobile:9898989898}})
```
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}
* db.users.find()
{
  _id: ObjectId('68411eb61c399b5b0f065846'),
  firsrName: 'Charan',
  lastName: 'K',
  email: 'charan.k@gmail.com',
  mobile: 9898989898
}

```
* Install Mangose
* integrate mangose library
* for the URL
* go to the database access and click on connect
* Then Click on Drivers option
* And then  Add your connection string into your application code
* mongodb+srv://Harikrishna:<db_password>@nodejs-cluster1.rm9towc.mongodb.net/?retryWrites=true&w=majority&appName=Nodejs-Cluster1
* index.js
```
const mongoose = require('mongoose')
```
* in the below url the password must be %40 for the '@'
* insted of Password: @20FH1a0596
```
Password : %4020FH1a0596
```
```
mongoose.connect('mongodb+srv://Harikrishna:%4020FH1a0596@nodejs-cluster1.rm9towc.mongodb.net/ecommerce-dev?retryWrites=true&w=majority&appName=Nodejs-Cluster1').then(()=>{
    console.log('connected to  DB Successfully!')
}).catch((error)=>{
    console.log(error)

})
```
* To create Model for a collection:
```
const mongoose = require('mongoose')
 const productSchema = mongoose.Schema({
    name:'String',
    imgSrc:'String',
    price:'String'

 })

 const productModel = mongoose.model(collectionName,productSchema);
```
* create folder in ec-services the folder name is 'models'
* And create file the file name is 'product.model.js'
* product.model.js
```
const mongoose = require('mongoose')

const productSchema = mongoose.Schema({
    name:{
        type:String,
        default:null,
        required:true
    },
    email:{
        type:String,
        default:''
    },
    actualPrice:{
        type:String,
        default:0
    },
    discount:{
        type:Number,
        default:0
    },
    specifications:{
        type:Array,
        default:[]
    },
    inStock:{
        type:Boolean,
        default:[]
    }

 });
 const productModel = mongoose.Schema('products',productSchema)
 module.exports = productModel;
```
# date: 1-11-2024 Topic: mongoose CRUD operations
# to automatically run the server 
* install
* Nodemon: it monitors the file changes and restarts the server.
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs\ec-services> npm install -global nodemon
```
* To start the server
* nodemon
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs\ec-services> npm install -global nodemon
```
# date:5-11-2024 Topic:Pagination
# Pagination
* in postman we can the url like these
```
http://localhost:3000/products/pagination?pageIndex=0&pageSize=1
```
* And the we enterd the values of pageIndex AND pageSize for what ever the records we want
* than we will get the products
```
{
    "metadata": {
        "noOfPages": 2,
        "hasNext": true,
        "hasPrevious": false
    },
    "data": [
        {
            "_id": "684a1757ca394d4e34f9b862",
            "name": " Vivo Galaxy M35 5G (Moonlight Blue, 128 GB)",
            "imgSrc": "https://rukminim2.flixcart.com/image/312/312/xif0q/mobile/x/y/l/-original-imah8pvvhmj76hvg.jpeg?q=70",
            "actualPrice": "59900",
            "discount": 20,
            "specifications": [
                "9 GB RAM | 128 GB ROM",
                "16.76 cm (6.6 inch) Display",
                "64MP Rear Camera",
                "6000 mAh Battery",
                "5 YEAR"
            ],
            "inStock": true,
            "__v": 0
        }
    ]
}
```
* For Pagination we can write the code
```
pagination: async (request,response)=>{
        const {pageIndex,pageSize} = request.query;
        try{
                const count = await productsModal.countDocuments();
                const roundedCount = Math.ceil(count/pageSize)
            const metadata={
                currentPage:parseInt(pageIndex)+1,
                noOfPages:count/pageSize,
                hasNext: (roundedCount === pageIndex+1),
                hasPrevious:pageIndex > 0
            }
            const products = await productsModal.find()
                                .skip(pageIndex*pageSize)
                                .limit(pageSize)
            response.status(200)
            response.send({
                metadata,
                data:products
            })
        }catch(error){
            response.status(500)
            response.send({
                message:'unable to retrieve product',
                error:error
            })
        }
    }
```
# Sorting :
* Ascending or descendeing order is a Sortung
* give the credential in the postman
```
http://localhost:3000/products/pagination?pageIndex=0&pageSize=15
```
```
pagination: async (request,response)=>{
        const {pageIndex,pageSize} = request.query;
        try{
                const count = await productsModal.countDocuments();
                const roundedCount = Math.ceil(count/pageSize)
            const metadata={
                currentPage:parseInt(pageIndex)+1,
                noOfPages:count/pageSize,
                hasNext: (roundedCount === pageIndex+1),
                hasPrevious:pageIndex > 0
            }
            const products = await productsModal.find()
                                .skip(pageIndex*pageSize)
                                .sort('discount') // Ascending Order
                                .limit(pageSize)
            response.status(200)
            response.send({
                metadata,
                data:products
            })
        }catch(error){
            response.status(500)
            response.send({
                message:'unable to retrieve product',
                error:error
            })
        }
    }
```
* Here is the additional requirements are orderParam and sortParam included
```
pagination: async (request,response)=>{
        const {pageIndex,pageSize,order,sortParam} = request.query;
        const orderParam =order === 'asc'? '':'-'
        try{
                const count = await productsModal.countDocuments();
                const roundedCount = Math.ceil(count/pageSize)
            const metadata={
                currentPage:parseInt(pageIndex)+1,
                noOfPages:count/pageSize,
                hasNext: (roundedCount === pageIndex+1),
                hasPrevious:pageIndex > 0
            }
            const products = await productsModal.find()
                                .skip(pageIndex*pageSize)
                                // .sort('discount') // Ascending Order
                                .sort(orderParam+sortParam)
                                .limit(pageSize)
            response.status(200)
            response.send({
                metadata,
                data:products
            })
        }catch(error){
            response.status(500)
            response.send({
                message:'unable to retrieve product',
                error:error
            })
        }
    }
```
* in postman we can give like these
```
http://localhost:3000/products/pagination?pageIndex=0&pageSize=15&order=asc&sortParam=discount
```

# User Model
* create a model the neame should be user.model.js
* user.model.js
```
const mongoose = require('mongoose')

const userSchema = new mongoose.Schema({
    firstName:{
        type:String,
        default:null,
    },
    lastName:{
        type:String,
        default:null
    },
    email:{
        type:String,
        default:null
    },
    password:{
        type:String,
        default:null
    },
    otp:{
        type:String,
        default:null
    },
    mobileNo:{
        type:String,
        default:null
    }

 });
//  const productModel = mongoose.Schema('products',productSchema)

 const userModel =mongoose.model('users',userSchema);
 module.exports = userModel;
```
* creating a folder services
* users.service.js
```
const userModel = require('../models/user.model')

const userSvc = {
    create: async(data) =>{
        const user = new userModel(data);
        return await user.save();
    },
    getAll:async()=>{
        return user.find()
    },
    getById: async()=>{
        return user.findById(id);
    }

}
module.exports =userSvc;
```
* users.ctrl.js
```
const userService = require('../services/users.service')

const userCtrl ={
    register:async(request,response)=>{
        try{
            const user = await userService.create(request.body)
            response.status(201)
            response.send({
                message:'Register User Successfully',
                data:user
            })

        }catch(error){
            response.status(500)
            response.send({
                error:'unable to register the user'
            })
        }
    }
}

module.exports = userCtrl;
```
* changes in
* users.router.js
```
const express = require('express');
const router = express.Router();
const usersCtrl = require('../controllers/users.ctrl')
router.post('/register',usersCtrl.register)
module.exports =router;

```
# date: 7-11-2024  Topic: Hashing
* Hashing Technique : Hashing is convert plain text into hash.
* Bcrypt:
* installation :
```
npm install bcrypt
```
```
PS C:\Users\HARIKRISHNA\Desktop\NodeJs\ec-services> npm install bcrypt
```

* To Hash Password :
```
const bcrypt = require('bcrypt');

    await bcrypt.hash(myPlaintextPassword, saltRounds)
```
* To compare Hash with Plain password :
```
 await bcrypt.compare(myPlaintextPassword, hash);
```
* to Login give the credentials like theese
* in postman 
```
http://localhost:3000/users/login-with-password
```
* in postman method is "Post"
* then go to the "body" and "raw" give this type of credentials
* for successsfull login
```
{
   "emailOrMobileNo": "srinu@gmail.com",
    "password": "srinu123"
}
```
* users.ctrl.js
```
loginWithPassword:async(request,response)=>{
        try{
            const user = await userService.getByEmailOrMobileNo(request.body.emailOrMobileNo)
            if(user){
                const isPasswordMatched = await bcrypt.compare(request.body.password,user.password);
                if(isPasswordMatched){
                    response.status(200)
                    response.send({
                        message:'Logged In Successfully!!'
                    })
                    
                }else{
                    response.status(400)
                    response.send({
                        message:'incorrect Password',
                    })
                }
                }else{
                response.status(400)
                response.send({
                    message:'unregistered email or mobile no'
                })
            }

        }catch(error){
            response.status(500)
            response.send({
                error:'unable to login the user'
            })
        }
    }
```
* for delete user
```
deleteUser: async(request,response)=>{
        try{
            await userService.deleteById(request.params.id);
            response.status(200)
            response.send({
                message:"deleted user successfully"
            })

        }catch(error){
            console.log(error)
            response.status(500)
            response.send({
                error:"unable to delete the user"
            })
        }
    }
```
* for get the user by Id
 ```
getById: async(request,response)=>{
        try{
            const user = await userService.getById(request.params.id);
            response.status(200)
            response.send({
                message:"  Retrieved user successfully",
                data:user
            })

        }catch(error){
            console.log(error)
            response.status(500)
            response.send({
                error:"unable to retrieve the user"
            })
        }
    },
```
* for get the all users
```
 getAll: async(request,response)=>{
        try{
            const user = await userService.getAll();
            response.status(200)
            response.send({
                message:"  Retrieved users successfully",
                data:user
            })

        }catch(error){
            console.log(error)
            response.status(500)
            response.send({
                error:"unable to retrieve the users"
            })
        }
    },
```
* for update the user
```
updateUser: async(request,response)=>{
        try{
            const user = await userService.updateUser(request.params.id,request.body)
            response.status(200)
            response.send({
                message:'user updated successfully',
                data:user
            })

        }catch(error){
            response.status(500)
            response.send({
                error:'unable to update user'
            })
        }
    }
```
* users.service.js
```
const userModel = require('../models/user.model')

const userSvc = {
    create: async(data) =>{
        const user = new userModel(data);
        return await user.save();
    },
    getAll:async()=>{
        return userModel.find()
    },
    getById: async()=>{
        return userModel.findById(id);
    },
    getByEmailOrMobileNo:(emailMobileNo)=>{
        return userModel.findOne({
            $or:[
                {email:emailMobileNo},
                {mobileNo:emailMobileNo}
            ]
        })
    },
    deleteById: async(id)=>{
        return userModel.findByIdAndDelete(id)
    },
    updateUser : async(id,data)=>{
        return userModel.findByIdAndUpdate(id,{$set:data},{new:true});
    }

}
module.exports =userSvc;
```
* users.router.js
```
router.post('/register',usersCtrl.register)
router.post('/login-with-password',usersCtrl.loginWithPassword)
router.delete('/:id',usersCtrl.deleteUser)
router.get('/:id',usersCtrl.getById)
router.get('/',usersCtrl.getAll)
router.put('/:id',usersCtrl.updateUser)
```
# Date : 08-11-2024 Topic: generate access token
* giveing these details in
* users.ctrl.js
```
  loginWithPassword:async(request,response)=>{
        try{
            const user = await userService.getByEmailOrMobileNo(request.body.emailOrMobileNo)
            if(user){
                const isPasswordMatched = await bcrypt.compare(request.body.password,user.password);
                if(isPasswordMatched){
                    const token = await jwt.sign({
                        email:user.email,
                        mobile:user.mobileNo
                    },'you can not steel my password',{expiresIn:'1h'})
                    response.status(200)
                    response.send({
                        message:'Logged In Successfully!!',
                        accesstoken:token
                    })
                    
                }else{
                    response.status(400)
                    response.send({
                        message:'incorrect Password',
                    })
                }
                }else{
                response.status(400)
                response.send({
                    message:'unregistered email or mobile no'
                })
            }

        }catch(error){
            response.status(500)
            response.send({
                error:'unable to login the user'
            })
        }
    }
```
* than we get the Json web token
* give this in postman body and raw
```
{
   "emailOrMobileNo": "srinu@gmail.com",
    "password": "srinu123"
}
```
* then will get the accesstoken
```
{
    "message": "Logged In Successfully!!",
    "accesstoken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InNyaW51QGdtYWlsLmNvbSIsIm1vYmlsZSI6IjU2MzYyNjUzMTQiLCJpYXQiOjE3NDk5NTI4MTcsImV4cCI6MTc0OTk1NjQxN30.Fe0SrBM8uKuENWaFs9Mum0wgyE4tEr47xBldYmueHx8"
}
```









  
